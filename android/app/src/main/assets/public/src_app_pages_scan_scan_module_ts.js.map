{"version":3,"file":"src_app_pages_scan_scan_module_ts.js","mappings":"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","sources":["./src/app/pages/scan/scan-routing.module.ts","./src/app/pages/scan/scan.module.ts","./src/app/pages/scan/scan.page.ts","./src/app/services/api-correos.service.ts","./src/app/services/api.service.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { ScanPage } from './scan.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ScanPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class ScanPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { ScanPageRoutingModule } from './scan-routing.module';\n\nimport { ScanPage } from './scan.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ScanPageRoutingModule\n  ],\n  declarations: [ScanPage]\n})\nexport class ScanPageModule {}\n","import { Component, OnInit } from '@angular/core';\n\n// Servicios\nimport { ApiService } from 'src/app/services/api.service';\nimport { SesionService } from 'src/app/services/sesion.service';\nimport { BdLocalService } from 'src/app/services/bd-local.service';\nimport { ApiCorreosService } from 'src/app/services/api-correos.service';\n\n// Plugins\nimport { BarcodeScanner } from '@ionic-native/barcode-scanner/ngx';\n\n@Component({\n  selector: 'app-scan',\n  templateUrl: './scan.page.html',\n  styleUrls: ['./scan.page.scss'],\n})\nexport class ScanPage implements OnInit {\n\n  code: any;\n  asignaturas: any;\n\n  clase = {\n    codigo: \" \",\n    asignatura : \" \",\n    seccion : \" \",\n    profesor: \" \",\n    fecha: \" \",\n    hora: \" \",\n    correoProf: \" \",\n  }\n\n  codigoComparable: string = \"\";\n  codigoBase: string = \"reg_app_cod\";\n  pageState: number = 1;\n\n  constructor(\n    private scanner: BarcodeScanner,\n    private api: ApiService,\n    private bdlocal: BdLocalService,\n    private sesion: SesionService,\n    private apiCorreo: ApiCorreosService) { }\n  \n  ngOnInit() {\n    this.startScan();\n  }\n\n  validarHorario(hra_ini, min_ini, hra_ter, min_ter){\n    let fecha = new Date();\n    let hora = fecha.getHours();\n    let min = fecha.getMinutes();\n    if (hora >= hra_ini && min >= min_ini && hora < hra_ter || hora == hra_ter && min <= min_ter) {\n      return true;\n    } else {\n      return false;\n    }  \n  }\n\n  matchClass(){\n    this.api.getAsignaturas().subscribe((data)=>{\n      this.asignaturas = data.asignatura \n\n      let hoy = new Date().getDay();\n\n      for (let i = 0; i < this.asignaturas.length; i++) {\n        //for (let j = 0; j < this.asignaturas[i].horario.length; j++) {\n          this.codigoComparable = this.codigoBase+\"*\"+this.asignaturas[i].codigo+\"*\"+this.asignaturas[i].seccion;\n          if (this.codigoComparable.toUpperCase() == this.code.toUpperCase()) { // && this.asignaturas[i].horario[j].dia == hoy\n\n            //if (this.validarHorario(this.asignaturas[i].horario[0].hra_ini, this.asignaturas[i].horario[0].min_ini, this.asignaturas[i].horario[0].hra_ter, this.asignaturas[i].horario[0].min_ter)) {\n              this.clase.codigo = this.asignaturas[i].codigo;\n              this.clase.asignatura = this.asignaturas[i].nombre;\n              this.clase.seccion = this.asignaturas[i].seccion;\n              this.clase.profesor = this.asignaturas[i].profesor;\n              this.clase.fecha = new Date().toLocaleDateString();\n              this.clase.hora = new Date().toLocaleTimeString();\n              this.clase.correoProf = this.asignaturas[i].correoProf;\n            //} else {\n            // alert(\"No es el horario de la clase\");\n            //}\n          } \n        //}\n      }\n    })\n  }\n\n  startScan(){\n    // force camera permission\n    \n    this.pageState = 1;\n\n    this.scanner.scan().then(barcodeData => {\n      this.code = barcodeData.text;\n      if  (this.code.substring(0,11) == this.codigoBase) {\n        this.pageState = 2;\n        this.matchClass();\n      } else {\n        this.pageState = 3;\n      }\n    }).catch(err => {\n        console.log('Error', err);\n    });\n  \n  }\n\n  mayusPrimeraLetra(palabra:string){\n    return palabra.charAt(0).toUpperCase()+palabra.slice(1);\n  }\n\n  mayusPalabras(palabras:string){\n    //esta funcion toma un string, los separa en un array por cada espacio, en el for le pone mayuscula a la primera letra de cada una y luego las vuelve a unir con un espacio entremedio\n    let palSeparadas = palabras.split(\" \");\n    for(let i = 0; i < palSeparadas.length; i++){\n      palSeparadas[i] = palSeparadas[i][0].toUpperCase()+palSeparadas[i].slice(1);\n    }\n    return palSeparadas.join(\" \");\n  }\n\n  registrarAsistencia(){\n    let idAsistencia = this.bdlocal.generarIdAsistencia(this.clase.codigo, this.clase.fecha);\n    let alumno = this.sesion.usuario.correo;\n    let enviar = this.bdlocal.guardarAsistencia(idAsistencia,alumno, this.clase.asignatura, this.clase.codigo, this.clase.seccion, this.clase.fecha, this.clase.hora, true);\n    //enviar correo\n    if(enviar){ //solo se envia correo si la asistencia no ha sido tomada hoy, segun la validacion de guardarAsistencia()\n      this.apiCorreo.enviarCorreo(\n        /*from*/'asistencia@duocuc.cl', \n        /*to*/this.clase.correoProf, //El recipiente es el correo del profesor. Ej: ya.villegas@profesor.duoc.cl\n        ///*to*/'p.cortes@duocuc.cl', //Para probar, se puede escribir un correo manualmente aqui\n        /*cc*/'', //para agregar mas destinatarios, se deben agregar a los Authorized Recipients en MailGun\n        /*subject*/'Asistencia registrada '+this.clase.codigo.toUpperCase()+' '+this.clase.seccion.toUpperCase(),\n        /*text*/'Se ha registrado asistencia en la asignatura de '+this.mayusPalabras(this.clase.asignatura)+' ('+this.clase.codigo.toUpperCase()+' '+this.clase.seccion.toUpperCase()+'), para el alumno '+this.mayusPrimeraLetra(this.sesion.usuario.nombre)+' '+this.mayusPrimeraLetra(this.sesion.usuario.apellido)+', en la fecha '+this.clase.fecha+' a las '+this.clase.hora+'.');\n       }\n    }\n\n}","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ApiCorreosService {\n\n  /* no estoy seguro como funciona el httpOptions, tuve que agregar los headers en la funcion manualmente\n  httpOptions = {\n    headers: new HttpHeaders\n      ({\n        'Authorization': 'Basic ' + '9fe0a678d85579ad66c05a7c69689aa5-2de3d545-23ea1fbc',\n        'Content-Type': 'application/x-www-form-urlencoded'\n      })\n  } \n  */\n\n  apiURL = 'https://api.mailgun.net/v3/sandboxf43489a9f7614e84af8f183724d6c85f.mailgun.org/messages'  //hay que agregarle /messages al final del link\n  apiKey = 'key-c12bf806897e339e387d0515fd70c89e'\n\n  constructor(private http: HttpClient) { }\n\n  enviarCorreo(from:string,to:string,cc:string,subject:string,text:string) {\n    return this.http.post(this.apiURL,\n      'from=' + from + '&to=' + to + '&cc=' + cc + '&subject=' + subject + '&text=' + text,\n      {\n        headers: {\n          'Authorization': 'Basic ' + btoa('api:' + this.apiKey),\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      }).subscribe(success => {\n        console.log(\"SUCCESS -> \" + JSON.stringify(success));\n      }, error => {\n        console.log(\"ERROR -> \" + JSON.stringify(error));\n      });\n  }\n\n}\n\n\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { retry } from 'rxjs/operators';\nimport { Observable } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\n\nexport class ApiService {\n\n  httpOptions = {\n    headers: new HttpHeaders\n      ({\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*'\n      })\n  } \n  \n apiURL = 'https://pcortesduoc.github.io/movilApi/clase.json'\n\n  constructor(private http: HttpClient) { }\n\n  getAsignaturas():Observable<any>{\n    return this.http.get(this.apiURL).pipe(\n      retry(3)\n    );\n  }\n\n}"],"names":[],"sourceRoot":"webpack:///","x_google_ignoreList":[]}